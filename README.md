# Pydio Cells + MinIO on K3s

å®Œå…¨ãªçµ±åˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆï¼ˆå˜ä¸€namespaceã€å†…éƒ¨DNSé€šä¿¡ã€Cloudflare Tunnelså¯¾å¿œï¼‰

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€K3sä¸Šã§Pydio Cellsã¨MinIOã‚’çµ±åˆã—ã¦å‹•ä½œã•ã›ã‚‹å®Œå…¨ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆã§ã™ã€‚

### ä¸»ãªç‰¹å¾´

- âœ… **å˜ä¸€namespaceæ§‹æˆ**: å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`cells` namespaceå†…ã§å‹•ä½œ
- âœ… **å†…éƒ¨DNSé€šä¿¡**: IPã‚¢ãƒ‰ãƒ¬ã‚¹ç›´æ¥æŒ‡å®šãªã—ã€å…¨ã¦Kubernetes DNSåã‚’ä½¿ç”¨
- âœ… **Cloudflare Tunnelså¯¾å¿œ**: å°†æ¥ã®å¤–éƒ¨å…¬é–‹ã«å‚™ãˆãŸè¨­è¨ˆ
- âœ… **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æœ€é©åŒ–**: MinIOã¨ã®å®Œå…¨ãªçµ±åˆã§å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ
- âœ… **æœ¬ç•ªç’°å¢ƒå¯¾å¿œ**: ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Œå‚™

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           cells namespace                        â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Pydio Cells  â”‚â”€â”€â”€â”€â”€>â”‚    MySQL     â”‚        â”‚
â”‚  â”‚  (Web UI)    â”‚      â”‚  (Database)  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                        â”‚
â”‚         v                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚    MinIO     â”‚                               â”‚
â”‚  â”‚  (Storage)   â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                  â”‚
â”‚  å†…éƒ¨é€šä¿¡: *.cells.svc.cluster.local            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          v
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Cloudflare  â”‚ (å°†æ¥ã®å¤–éƒ¨å…¬é–‹ç”¨)
    â”‚   Tunnel    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- K3s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼ˆå‹•ä½œç¢ºèªæ¸ˆã¿ï¼‰
- kubectl ã‚³ãƒãƒ³ãƒ‰
- åˆ©ç”¨å¯èƒ½ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹: `local-path`

### ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆæ—¢ã«ã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
cd ~/MinIO_PydioCells

# 2. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x deploy-cells.sh

# 3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
./deploy-cells.sh
```

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã¾ã§ç´„3-5åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚

## ğŸ“¦ ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. MinIO (ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)
- **ç”¨é€”**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 20Gi PVC
- **å†…éƒ¨ã‚¢ã‚¯ã‚»ã‚¹**: `http://minio.cells.svc.cluster.local:9000`
- **Console**: NodePort 30901

### 2. MySQL (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)
- **ç”¨é€”**: Pydio Cellsã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 10Gi PVC
- **å†…éƒ¨ã‚¢ã‚¯ã‚»ã‚¹**: `mysql.cells.svc.cluster.local:3306`
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: MySQL 8.0

### 3. Pydio Cells (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)
- **ç”¨é€”**: ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ãƒ»ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 10Gi PVC
- **å†…éƒ¨ã‚¢ã‚¯ã‚»ã‚¹**: `http://pydio-cells.cells.svc.cluster.local:8080`
- **å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹**: NodePort 30808

## ğŸ”§ åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. Pydio Cellsã¸ã‚¢ã‚¯ã‚»ã‚¹

```bash
# ãƒãƒ¼ãƒ‰IPã®å–å¾—
NODE_IP=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type=="InternalIP")].address}')

# ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
echo "http://${NODE_IP}:30808"
```

### 2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—: MySQL
   - ãƒ›ã‚¹ãƒˆ: `mysql.cells.svc.cluster.local`
   - ãƒãƒ¼ãƒˆ: `3306`
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å: `cells`
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼å: `cells`
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: `cells-db-password-change-me`

2. **MinIOã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­å®š**
   - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—: S3 Compatible
   - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `http://minio.cells.svc.cluster.local:9000`
   - Access Key: `pydio-access-key`
   - Secret Key: `pydio-secret-key-change-me-in-production`
   - ãƒã‚±ãƒƒãƒˆå: `pydio-data`
   - ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: `us-east-1` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)

3. **ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
   - ãŠå¥½ã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š

## ğŸŒ Cloudflare Tunnels ã§ã®å¤–éƒ¨å…¬é–‹

å°†æ¥çš„ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«å…¬é–‹ã™ã‚‹å ´åˆ:

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

1. **Cloudflare Tunnelã®ä½œæˆ**
   ```bash
   cloudflared tunnel create pydio-cells
   ```

2. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†**
   ```bash
   vi cloudflare-tunnel-config.yaml
   # å®Ÿéš›ã®Tunnel IDã€credentialsã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®š
   ```

3. **DNSè¨­å®š**
   Cloudflareãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä»¥ä¸‹ã®CNAMEãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ :
   - `cells.yourdomain.com` â†’ `<tunnel-id>.cfargotunnel.com`
   - `minio.yourdomain.com` â†’ `<tunnel-id>.cfargotunnel.com`

4. **ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   kubectl apply -f cloudflare-tunnel-config.yaml
   ```

è©³ç´°ã¯ `cloudflare-tunnel-config.yaml` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Podã®çŠ¶æ…‹ç¢ºèª

```bash
kubectl get pods -n cells
```

### ãƒ­ã‚°ç¢ºèª

```bash
# Pydio Cellsã®ãƒ­ã‚°
kubectl logs -n cells deployment/pydio-cells -f

# MinIOã®ãƒ­ã‚°
kubectl logs -n cells deployment/minio -f

# MySQLã®ãƒ­ã‚°
kubectl logs -n cells statefulset/mysql -f
```

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. Pydio CellsãŒèµ·å‹•ã—ãªã„

```bash
# ä¾å­˜ã‚µãƒ¼ãƒ“ã‚¹ã®ç¢ºèª
kubectl get pods -n cells

# MySQLã¨MinIOãŒå…ˆã«èµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
```

#### 2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¤±æ•—ã™ã‚‹

```bash
# MinIOã®æ¥ç¶šç¢ºèª
kubectl exec -it -n cells deployment/pydio-cells -- nc -zv minio.cells.svc.cluster.local 9000

# MinIOã®ãƒ­ã‚°ç¢ºèª
kubectl logs -n cells deployment/minio -f
```

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# MySQLæ¥ç¶šãƒ†ã‚¹ãƒˆ
kubectl exec -it -n cells statefulset/mysql -- mysql -u cells -p'cells-db-password-change-me' cells

# æ¥ç¶šã§ãã‚Œã°OK
```

## ğŸ“Š ãƒªã‚½ãƒ¼ã‚¹è¦ä»¶

### æœ€å°æ§‹æˆ
- CPU: 2 cores
- ãƒ¡ãƒ¢ãƒª: 4GB
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 40GB

### æ¨å¥¨æ§‹æˆ
- CPU: 4 cores
- ãƒ¡ãƒ¢ãƒª: 8GB
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 100GB+

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### æœ¬ç•ªç’°å¢ƒã§å¿…é ˆã®è¨­å®šå¤‰æ›´

1. **å…¨ã¦ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´**
   ```bash
   # cells-complete.yamlå†…ã®ä»¥ä¸‹ã‚’å¤‰æ›´:
   # - minio-credentials
   # - mysql-credentials
   ```

2. **TLSã®æœ‰åŠ¹åŒ–**
   - æœ¬ç•ªç’°å¢ƒã§ã¯HTTPSã‚’ä½¿ç”¨
   - Cloudflare Tunnelã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯è‡ªå‹•çš„ã«HTTPSåŒ–

3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒªã‚·ãƒ¼ã®è¨­å®š**
   ```bash
   # å¿…è¦ãªé€šä¿¡ã®ã¿è¨±å¯
   kubectl apply -f network-policies.yaml
   ```

## ğŸ—‘ï¸ ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# å…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
kubectl delete namespace cells

# PVCã‚‚å‰Šé™¤ã•ã‚Œã‚‹å ´åˆã€ãƒ‡ãƒ¼ã‚¿ã¯å®Œå…¨ã«æ¶ˆå»ã•ã‚Œã¾ã™
```

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Pydio Cellså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pydio.com/en/docs/cells/v4)
- [MinIOå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://min.io/docs/minio/kubernetes/upstream/)
- [Cloudflare Tunnel ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/)
- [K3så…¬å¼ã‚µã‚¤ãƒˆ](https://k3s.io/)

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ã™ã€‚
å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯å€‹åˆ¥ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ğŸ¤ è²¢çŒ®

Issueã€Pull Requestã‚’æ­“è¿ã—ã¾ã™ï¼

---

**ä½œæˆæ—¥**: 2025-10-26  
**ä½œæˆè€…**: Pydio Cells K3s ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
